<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XX集团全国招聘地图</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            north: '#9f7aea',
            south: '#38b2ac',
            central: '#4299e1',
            additive: '#ed8936',
            premix: '#8c613c',
            headquarters: '#e53e3e',
            primary: '#4299e1',
            admin: '#4f46e5',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444'
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
            'scale-in': 'scaleIn 0.3s ease-in-out',
            'pulse-slow': 'pulse 2s infinite',
            'bounce-slow': 'bounce 2s infinite'
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            scaleIn: {
              '0%': { transform: 'scale(0.95)', opacity: '0' },
              '100%': { transform: 'scale(1)', opacity: '1' },
            },
            pulse: {
              '0%, 100%': { transform: 'scale(1)', opacity: '1' },
              '75%, 100%': { transform: 'scale(1.5)', opacity: '0' },
            },
            bounce: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-5px)' },
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .map-hover {
        @apply transition-all duration-300 hover:scale-105 hover:shadow-lg;
      }
      .card-shadow {
        @apply shadow-md hover:shadow-lg transition-shadow duration-300;
      }
      .text-bold-important {
        @apply font-bold text-gray-800;
      }
      .modal-transition {
        @apply animate-fade-in;
      }
      .card-transition {
        @apply animate-scale-in;
      }
      .headquarters-dot {
        @apply w-5 h-5 rounded-full bg-headquarters border-2 border-white shadow-lg animate-pulse-slow cursor-pointer relative;
      }
      .headquarters-dot::after {
        content: '';
        @apply absolute inset-0 rounded-full bg-headquarters/30 animate-ping-slow;
      }
      .headquarters-tooltip {
        @apply bg-white p-3 rounded-md shadow-lg text-sm border border-gray-200 font-medium;
      }
      .headquarters-label {
        @apply absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-headquarters text-white text-xs py-1 px-2 rounded whitespace-nowrap shadow-md;
      }
      .animate-ping-slow {
        animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
      }
      @keyframes ping {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        75%, 100% {
          transform: scale(1.5);
          opacity: 0;
        }
      }
      .admin-table th {
        @apply bg-gray-50 px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
      }
      .admin-table td {
        @apply px-4 py-3 whitespace-nowrap text-sm text-gray-700;
      }
      .btn-primary {
        @apply px-3 py-1 bg-admin text-white rounded text-sm hover:bg-admin/90 transition-colors;
      }
      .btn-success {
        @apply px-3 py-1 bg-success text-white rounded text-sm hover:bg-success/90 transition-colors;
      }
      .btn-warning {
        @apply px-3 py-1 bg-warning text-white rounded text-sm hover:bg-warning/90 transition-colors;
      }
      .btn-danger {
        @apply px-3 py-1 bg-danger text-white rounded text-sm hover:bg-danger/90 transition-colors;
      }
      .btn-secondary {
        @apply px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300 transition-colors;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-700">
  <!-- 顶部导航栏 -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row items-center justify-between gap-4">
      <!-- 系统标题 -->
      <div class="flex items-center space-x-2">
        <i class="fa fa-map-marker text-headquarters text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold text-gray-800">XX集团全国招聘地图</h1>
      </div>
      
      <!-- 功能区 -->
      <div class="flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto">
        <!-- 搜索框 -->
        <div class="relative w-full md:w-64 lg:w-80">
          <input 
            type="text" 
            id="search-input"
            placeholder="搜索省份、子公司或岗位名称..." 
           
            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
          >
          <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
        
        <!-- 管理员登录按钮 -->
        <button id="admin-login-btn" class="flex items-center justify-center bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-all duration-300">
          <i class="fa fa-user-secret mr-2"></i>管理员登录
        </button>
        
        <!-- 帮助按钮 -->
        <button id="help-btn" class="flex items-center justify-center bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-all duration-300">
          <i class="fa fa-question-circle mr-2"></i>帮助
        </button>
      </div>
    </div>
    
    <!-- 数据统计栏 -->
    <div class="bg-gray-50 border-t border-gray-200 py-3">
      <div class="container mx-auto px-4 flex flex-col md:flex-row items-start md:items-center justify-between gap-2 text-sm">
        <div class="flex items-center gap-6 mb-2 md:mb-0">
          <span><i class="fa fa-building-o text-primary mr-1"></i> 子公司总数: <span id="company-count" class="font-bold">0</span></span>
          <span><i class="fa fa-briefcase text-success mr-1"></i> 招聘岗位数: <span id="position-count" class="font-bold">0</span></span>
        </div>
        <div class="flex items-center gap-4 flex-wrap" id="region-counts">
          <!-- 区域计数将动态生成 -->
        </div>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="container mx-auto px-4 py-6">
    <!-- 地图展示区域 -->
    <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
      <div id="map-container" class="w-full h-[400px] md:h-[600px] border border-gray-200 rounded-lg relative">
        <!-- 总部标记点将通过JS动态添加 -->
        <div id="headquarters-marker" class="absolute hidden" style="left: 50%; top: 50%;">
          <div class="headquarters-dot" title="集团总部（江苏太仓）">
            <i class="fa fa-building text-white text-xs absolute inset-0 flex items-center justify-center"></i>
          </div>
          <div class="headquarters-label">集团总部</div>
          <div class="headquarters-tooltip hidden absolute -top-16 left-1/2 transform -translate-x-1/2">
            <div class="font-bold text-headquarters">集团总部</div>
            <div class="text-xs text-gray-500">江苏太仓</div>
            <div class="text-xs text-gray-400 mt-1">点击查看招聘岗位</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-gray-800 text-gray-400 py-6">
    <div class="container mx-auto px-4 text-center">
      <p class="text-sm md:text-base">© 2025 XX集团 版权所有 | 招聘咨询热线：400-123-4567</p>
    </div>
  </footer>

  <!-- 弹窗组件 -->
  <!-- 原有的弹窗组件保持不变，这里只展示新增的管理员相关弹窗 -->

  <!-- 管理员登录弹窗 -->
  <div id="login-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-xl w-full max-w-md p-4 md:p-6 modal-transition mx-2">
      <div class="flex justify-between items-center mb-4 md:mb-6">
        <h3 class="text-lg md:text-xl font-bold text-gray-800">管理员登录</h3>
        <button id="close-login-modal" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <form id="login-form" class="space-y-4">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
          <input 
            type="text" 
            id="username" 
            name="username"
            placeholder="请输入管理员账号"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
          >
        </div>
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
          <input 
            type="password" 
            id="password" 
            name="password"
            placeholder="请输入管理员密码"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
          >
        </div>
        <div class="pt-2">
          <button type="submit" class="w-full px-4 py-2 bg-admin text-white rounded-lg hover:bg-admin/90 transition-colors">
            <i class="fa fa-sign-in mr-2"></i>登录
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 管理员面板弹窗 -->
  <div id="admin-panel-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 class="text-base md:text-lg font-semibold text-gray-800 flex items-center">
          <i class="fa fa-user-secret text-admin mr-2"></i> 招聘数据管理系统
        </h3>
        <button id="close-admin-panel" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="flex-1 overflow-y-auto">
        <div class="p-4 md:p-6 space-y-4 md:space-y-6">
          <!-- 数据上传区域 -->
          <div class="bg-gray-50 p-3 md:p-4 rounded-lg border border-gray-200">
            <h4 class="text-base md:text-lg font-semibold text-gray-800 mb-3 md:mb-4 flex items-center">
              <i class="fa fa-upload text-admin mr-2"></i> 数据上传
            </h4>
            <div class="space-y-3 md:space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Excel文件上传</label>
                <div class="flex items-center gap-2">
                  <label for="admin-excel-upload" class="btn-upload flex-1 flex items-center justify-center bg-admin/10 text-admin px-4 py-6 md:py-8 rounded-lg border-2 border-dashed border-admin/30 hover:bg-admin/20 transition-colors cursor-pointer">
                    <div class="text-center">
                      <i class="fa fa-file-excel-o text-2xl md:text-3xl mb-2"></i>
                      <p class="text-xs md:text-sm">点击或拖拽Excel文件到此处</p>
                      <p class="text-xs text-gray-500 mt-1">支持.xlsx, .xls格式</p>
                    </div>
                  </label>
                  <input id="admin-excel-upload" type="file" accept=".xlsx,.xls" class="hidden">
                </div>
              </div>
              <div class="pt-2 flex flex-col md:flex-row gap-2">
                <button id="upload-excel-btn" class="flex-1 px-4 py-2 bg-admin text-white rounded-lg hover:bg-admin/90 transition-colors">
                  <i class="fa fa-cloud-upload mr-2"></i>上传并更新数据
                </button>
                <button id="export-excel-btn" class="flex-1 px-4 py-2 bg-success text-white rounded-lg hover:bg-success/90 transition-colors">
                  <i class="fa fa-download mr-2"></i>导出Excel数据
                </button>
              </div>
            </div>
          </div>
          
          <!-- 数据管理区域 -->
          <div class="bg-gray-50 p-3 md:p-4 rounded-lg border border-gray-200">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-3 md:mb-4 gap-2">
              <h4 class="text-base md:text-lg font-semibold text-gray-800 flex items-center">
                <i class="fa fa-database text-admin mr-2"></i> 数据管理
              </h4>
              <div class="flex gap-2">
                <button id="add-company-btn" class="btn-primary text-xs md:text-sm">
                  <i class="fa fa-plus mr-1"></i>添加公司
                </button>
              </div>
            </div>
            
            <!-- 公司列表 -->
            <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 admin-table">
                  <thead>
                    <tr>
                      <th class="text-xs md:text-sm">区域</th>
                      <th class="text-xs md:text-sm">省份</th>
                      <th class="text-xs md:text-sm">公司名称</th>
                      <th class="text-xs md:text-sm">岗位数量</th>
                      <th class="text-xs md:text-sm">操作</th>
                    </tr>
                  </thead>
                  <tbody id="admin-company-list" class="bg-white divide-y divide-gray-200">
                    <!-- 公司列表将动态生成 -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex flex-col md:flex-row justify-between items-start md:items-center gap-2">
        <div class="text-xs md:text-sm text-gray-600">
          当前数据：<span id="admin-data-count">0</span> 家公司，<span id="admin-position-count">0</span> 个岗位
        </div>
        <button id="logout-btn" class="px-3 md:px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-xs md:text-sm">
          <i class="fa fa-sign-out mr-1"></i>退出登录
        </button>
      </div>
    </div>
  </div>

  <!-- 添加/编辑公司弹窗 -->
  <div id="company-modal-admin" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 id="company-modal-title" class="text-base md:text-lg font-semibold text-gray-800">添加子公司</h3>
        <button id="close-company-modal-admin" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <form id="company-form" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-3 md:space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
          <div>
            <label for="company-region" class="block text-sm font-medium text-gray-700 mb-1">所属区域 *</label>
            <select 
              id="company-region" 
              name="region"
              class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
              required
            >
              <option value="">请选择区域</option>
              <option value="华北">华北区</option>
              <option value="华南">华南区</option>
              <option value="华中">华中区</option>
              <option value="添加剂">添加剂</option>
              <option value="预混料">预混料</option>
              <option value="总部">总部</option>
            </select>
          </div>
          <div>
            <label for="company-province" class="block text-sm font-medium text-gray-700 mb-1">省份 *</label>
            <input 
              type="text" 
              id="company-province" 
              name="province"
              placeholder="请输入省份"
              class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
              required
            >
          </div>
        </div>
        
        <div>
          <label for="company-name" class="block text-sm font-medium text-gray-700 mb-1">公司名称 *</label>
          <input 
            type="text" 
            id="company-name" 
            name="company"
            placeholder="请输入公司名称"
            class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
            required
          >
        </div>
        
        <div>
          <label for="company-address" class="block text-sm font-medium text-gray-700 mb-1">公司地址 *</label>
          <input 
            type="text" 
            id="company-address" 
            name="address"
            placeholder="请输入详细地址"
            class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
            required
          >
        </div>
        
        <div>
          <label for="company-contact" class="block text-sm font-medium text-gray-700 mb-1">联系电话 *</label>
          <input 
            type="text" 
            id="company-contact" 
            name="contact"
            placeholder="请输入联系电话"
            class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
            required
          >
        </div>
        
        <div>
          <label for="company-email" class="block text-sm font-medium text-gray-700 mb-1">招聘邮箱 *</label>
          <input 
            type="email" 
            id="company-email" 
            name="email"
            placeholder="请输入招聘邮箱"
            class="w-full px-3 md:px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-admin/50 focus:border-admin transition-all"
            required
          >
        </div>
        
        <!-- 岗位管理区域 -->
        <div class="border-t border-gray-200 pt-3 md:pt-4 mt-3 md:mt-4">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-3 md:mb-4 gap-2">
            <h4 class="text-base md:text-lg font-semibold text-gray-800">招聘岗位管理</h4>
            <button type="button" id="add-position-btn" class="btn-success text-xs md:text-sm">
              <i class="fa fa-plus mr-1"></i>添加岗位
            </button>
          </div>
          
          <div id="positions-container" class="space-y-3 md:space-y-4">
            <!-- 岗位表单将动态添加到这里 -->
          </div>
        </div>
      </form>
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex justify-end gap-2">
        <button id="cancel-company-modal" class="btn-secondary text-xs md:text-sm">取消</button>
        <button type="submit" form="company-form" class="btn-primary text-xs md:text-sm">
          <i class="fa fa-save mr-1"></i>保存
        </button>
      </div>
    </div>
  </div>

  <!-- 搜索结果弹窗 -->
  <div id="search-results-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 id="search-results-title" class="text-base md:text-lg font-semibold text-gray-800">搜索结果</h3>
        <button id="close-search-results" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div id="search-results-content" class="flex-1 overflow-y-auto p-4 md:p-6">
        <!-- 搜索结果将动态生成 -->
      </div>
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex justify-end">
        <button id="close-search-results-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm md:text-base">
          关闭
        </button>
      </div>
    </div>
  </div>

  <!-- 省份公司列表弹窗 -->
  <div id="province-companies-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 id="province-companies-title" class="text-base md:text-lg font-semibold text-gray-800">省份公司列表</h3>
        <button id="close-province-companies" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div id="province-companies-content" class="flex-1 overflow-y-auto p-4 md:p-6">
        <!-- 省份公司列表将动态生成 -->
      </div>
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex justify-end">
        <button id="close-province-companies-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm md:text-base">
          返回地图
        </button>
      </div>
    </div>
  </div>

  <!-- 公司岗位列表弹窗 -->
  <div id="company-positions-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-4xl max-h-[80vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 id="company-positions-title" class="text-base md:text-lg font-semibold text-gray-800">公司岗位列表</h3>
        <button id="close-company-positions" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div id="company-positions-content" class="flex-1 overflow-y-auto p-4 md:p-6">
        <!-- 公司岗位列表将动态生成 -->
      </div>
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex flex-col md:flex-row justify-between gap-2">
        <button id="back-to-companies-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm md:text-base">
          <i class="fa fa-arrow-left mr-2"></i>返回子公司列表
        </button>
        <button id="close-company-positions-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm md:text-base">
          返回地图
        </button>
      </div>
    </div>
  </div>

  <!-- 岗位详情弹窗 -->
  <div id="position-detail-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 id="position-detail-title" class="text-base md:text-lg font-semibold text-gray-800">岗位详情</h3>
        <button id="close-position-detail" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div id="position-detail-content" class="flex-1 overflow-y-auto p-4 md:p-6">
        <!-- 岗位详情将动态生成 -->
      </div>
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex flex-col md:flex-row justify-between gap-2">
        <button id="back-to-positions-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm md:text-base">
          <i class="fa fa-arrow-left mr-2"></i>返回岗位列表
        </button>
        <button id="close-position-detail-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm md:text-base">
          返回地图
        </button>
      </div>
    </div>
  </div>

  <!-- 成功/错误提示弹窗 -->
  <div id="success-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-md p-4 md:p-6 text-center modal-transition">
      <div class="inline-flex items-center justify-center w-12 h-12 md:w-16 md:h-16 rounded-full bg-green-100 text-green-500 text-xl md:text-2xl mb-3 md:mb-4">
        <i class="fa fa-check"></i>
      </div>
      <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-2">操作成功</h3>
      <p id="success-message" class="text-gray-600 mb-4 md:mb-6 text-sm md:text-base">数据已成功更新</p>
      <button id="close-success-modal" class="px-4 md:px-6 py-2 bg-admin text-white rounded-lg hover:bg-admin/90 transition-colors text-sm md:text-base">
        确定
      </button>
    </div>
  </div>

  <div id="error-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-md p-4 md:p-6 text-center modal-transition">
      <div class="inline-flex items-center justify-center w-12 h-12 md:w-16 md:h-16 rounded-full bg-red-100 text-red-500 text-xl md:text-2xl mb-3 md:mb-4">
        <i class="fa fa-exclamation-triangle"></i>
      </div>
      <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-2">操作失败</h3>
      <p id="error-message" class="text-gray-600 mb-4 md:mb-6 text-sm md:text-base">请检查文件格式是否正确</p>
      <button id="close-error-modal" class="px-4 md:px-6 py-2 bg-danger text-white rounded-lg hover:bg-danger/90 transition-colors text-sm md:text-base">
        确定
      </button>
    </div>
  </div>

  <!-- 上传加载中弹窗 -->
  <div id="upload-loading" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-md p-4 md:p-6 text-center modal-transition">
      <div class="inline-block animate-spin rounded-full h-10 w-10 md:h-12 md:w-12 border-t-2 border-b-2 border-admin mb-3 md:mb-4"></div>
      <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-2">正在处理</h3>
      <p class="text-gray-600 text-sm md:text-base">请稍候，正在解析并更新数据...</p>
    </div>
  </div>

  <!-- 帮助弹窗 -->
  <div id="help-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-2 md:p-4">
    <div class="bg-white rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col modal-transition">
      <div class="p-3 md:p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50">
        <h3 class="text-base md:text-lg font-semibold text-gray-800 flex items-center">
          <i class="fa fa-question-circle text-primary mr-2"></i> 系统使用帮助
        </h3>
        <button id="close-help-modal" class="text-gray-500 hover:text-gray-700 transition-colors">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      <div class="flex-1 overflow-y-auto p-4 md:p-6">
        <div class="space-y-6">
          <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <h4 class="font-semibold text-blue-800 mb-2 text-base md:text-lg flex items-center">
              <i class="fa fa-map-marker text-blue-600 mr-2"></i> 查看招聘信息
            </h4>
            <p class="text-blue-700 text-sm md:text-base">点击地图上的省份，查看该省份的所有子公司及招聘岗位。</p>
          </div>
          
          <div class="bg-green-50 p-4 rounded-lg border border-green-200">
            <h4 class="font-semibold text-green-800 mb-2 text-base md:text-lg flex items-center">
              <i class="fa fa-search text-green-600 mr-2"></i> 搜索功能
            </h4>
            <p class="text-green-700 text-sm md:text-base">在顶部搜索框中输入省份、子公司或岗位名称，快速查找相关信息。</p>
          </div>
          
          <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
            <h4 class="font-semibold text-purple-800 mb-2 text-base md:text-lg flex items-center">
              <i class="fa fa-phone text-purple-600 mr-2"></i> 联系公司
            </h4>
            <p class="text-purple-700 text-sm md:text-base">在岗位详情页面，可以直接拨打电话或发送邮件联系招聘负责人。</p>
          </div>
        </div>
      </div>
      <div class="p-3 md:p-4 border-t border-gray-200 bg-gray-50 flex justify-end">
        <button id="close-help-modal-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm md:text-base">
          我明白了
        </button>
      </div>
    </div>
  </div>

  <script>
    // 数据结构和初始化代码
    const allProvinces = ['北京', '天津', '河北', '山西', '内蒙古', '辽宁', '吉林', '黑龙江', '上海', '江苏', '浙江', '安徽', '福建', '江西', '山东', '河南', '湖北', '湖南', '广东', '广西', '海南', '重庆', '四川', '贵州', '云南', '西藏', '陕西', '甘肃', '青海', '宁夏', '新疆', '香港', '澳门', '台湾'];

    const regionConfig = {
      '华北': { color: '#9f7aea', provinces: ['北京', '天津', '河北', '山西', '内蒙古'], count: 0 },
      '华南': { color: '#38b2ac', provinces: ['广东', '广西', '海南', '福建', '台湾', '香港', '澳门'], count: 0 },
      '华中': { color: '#4299e1', provinces: ['河南', '湖北', '湖南', '江西', '安徽'], count: 0 },
      '添加剂': { color: '#ed8936', provinces: ['山东', '江苏', '浙江', '上海'], count: 0 },
      '预混料': { color: '#8c613c', provinces: ['四川', '重庆', '贵州', '云南', '西藏'], count: 0 },
      '总部': { color: '#e53e3e', province: '江苏', city: '太仓', count: 0 }
    };

    // 模拟数据 - 修复工作地点属于岗位信息
    let recruitData = [
      {
        region: '华北',
        province: '北京',
        company: '北京分公司',
        address: '北京市朝阳区建国路88号现代国际大厦A座25层',
        contact: '010-88886666',
        email: 'hr-beijing@xxgroup.com',
        positions: [
          {
            name: '销售经理',
            workLocation: '北京市朝阳区', // 工作地点属于岗位
            hotline: '010-88886666-801', // 新增招聘热线字段
            responsibilities: ['负责华北区域销售团队管理及销售目标达成', '制定区域销售策略和市场推广计划'],
            requirements: ['本科及以上学历，市场营销、工商管理等相关专业', '5年以上快消品行业销售经验'],
            salary: '18-25K/月 + 绩效奖金 + 年终分红'
          },
          {
            name: '财务主管',
            workLocation: '北京市海淀区', // 工作地点属于岗位
            hotline: '010-88886666-802', // 新增招聘热线字段
            responsibilities: ['负责分公司财务核算、报表编制和财务分析', '管理财务团队，制定财务管理制度和流程'],
            requirements: ['本科及以上学历，会计学、财务管理等相关专业', '3年以上财务主管工作经验'],
            salary: '12-18K/月 + 年终奖金'
          }
        ]
      },
      {
        region: '华南',
        province: '广东',
        company: '广州分公司',
        address: '广东省广州市天河区珠江新城冼村路28号富力中心32层',
        contact: '020-87776666',
        email: 'hr-guangzhou@xxgroup.com',
        positions: [
          {
            name: '销售经理',
            workLocation: '广州市天河区', // 工作地点属于岗位
            hotline: '020-87776666-801', // 新增招聘热线字段
            responsibilities: ['负责华南区域销售团队管理及销售目标达成'],
            requirements: ['本科及以上学历，市场营销、工商管理等相关专业', '3年以上销售经验'],
            salary: '15-22K/月 + 绩效奖金'
          },
          {
            name: '市场专员',
            workLocation: '广州市白云区', // 工作地点属于岗位
            hotline: '020-87776666-802', // 新增招聘热线字段
            responsibilities: ['负责区域市场调研和竞品分析', '策划和执行市场推广活动'],
            requirements: ['本科及以上学历，市场营销、广告学等相关专业', '2年以上市场相关工作经验'],
            salary: '8-12K/月 + 绩效奖金'
          }
        ]
      },
      {
        region: '总部',
        province: '江苏',
        company: '集团总部',
        address: '江苏省太仓市经济开发区北京东路88号集团大厦',
        contact: '0512-53538888',
        email: 'hr-headquarters@xxgroup.com',
        positions: [
          {
            name: '战略规划经理',
            workLocation: '太仓市经济开发区', // 工作地点属于岗位
            hotline: '0512-53538888-801', // 新增招聘热线字段
            responsibilities: ['负责集团中长期战略规划制定和实施', '分析行业发展趋势和市场竞争格局'],
            requirements: ['硕士及以上学历，工商管理、战略管理等相关专业', '5年以上企业战略规划经验'],
            salary: '25-40K/月 + 年终分红 + 股票期权'
          }
        ]
      }
    ];

    // 全局变量
    let myChart = null;
    let currentProvince = null;
    let currentCompany = null;
    let currentPosition = null;
    let isAdminLoggedIn = false;
    let currentEditingCompanyIndex = -1; // -1表示新增，>=0表示编辑
    let searchResults = []; // 存储搜索结果

    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      init();
      bindEvents();
    });

    // 初始化函数
    async function init() {
      await initMap();
      updateStatistics();
      showHeadquartersMarker();
    }

    // 初始化地图
    async function initMap() {
      myChart = echarts.init(document.getElementById('map-container'));
      
      try {
        // 加载中国地图数据
        const response = await fetch('https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json');
        const chinaJson = await response.json();
        
        // 修改省份名称显示格式
        chinaJson.features.forEach(feature => {
          const name = feature.properties.name;
          // 简化省份名称显示
          if (name.includes('新疆')) {
            feature.properties.name = '新疆';
          } else if (name.includes('宁夏')) {
            feature.properties.name = '宁夏';
          } else if (name.includes('香港')) {
            feature.properties.name = '香港';
          } else if (name.includes('澳门')) {
            feature.properties.name = '澳门';
          } else if (name.includes('广西')) {
            feature.properties.name = '广西';
          } else if (name.endsWith('省') || name.endsWith('市') || name.endsWith('自治区')) {
            feature.properties.name = name.replace(/(省|市|自治区)$/, '');
          }
        });
        
        echarts.registerMap('china', chinaJson);
        
        // 配置地图选项 - 优化字体大小自适应
        const containerWidth = document.getElementById('map-container').offsetWidth;
        const baseFontSize = containerWidth < 768 ? 8 : 10; // 移动端使用更小的字体
        
        const option = {
          backgroundColor: '#ffffff',
          tooltip: {
            trigger: 'item',
            formatter: function(params) {
              // 在移动端不显示tooltip
              if (window.innerWidth < 768) {
                return '';
              }
              
              const provinceData = getProvinceData(params.name);
              if (provinceData.companies.length > 0) {
                return `<div class="font-bold">${params.name}</div>
                        <div>子公司数量: ${provinceData.companies.length} 家</div>
                        <div>招聘岗位: ${provinceData.positionCount} 个</div>
                        <div class="text-gray-500 text-sm">点击查看详情</div>`;
              } else {
                return `<div class="font-bold">${params.name}</div>
                        <div class="text-gray-500">暂无招聘信息</div>`;
              }
            }
          },
          series: [
            {
              name: '招聘区域',
              type: 'map',
              map: 'china',
              roam: true,
              scaleLimit: {
                min: 1.2,
                max: 10
              },
              label: {
                show: true,
                fontSize: baseFontSize,
                color: '#333',
                emphasis: {
                  color: '#fff',
                  fontSize: baseFontSize + 1,
                  fontWeight: 'bold'
                }
              },
              emphasis: {
                label: {
                  show: true
                },
                itemStyle: {
                  areaColor: '#4299e1',
                  borderWidth: 2,
                  borderColor: '#fff'
                }
              },
              itemStyle: {
                areaColor: '#e8f4f8',
                borderColor: '#ffffff',
                borderWidth: 1,
                shadowColor: 'rgba(0,0,0,0.05)',
                shadowBlur: 2
              },
              data: getAllProvinceMapData()
            },
            // 添加总部标记系列
            {
              name: '总部标记',
              type: 'effectScatter',
              coordinateSystem: 'geo',
              data: [
                {
                  name: '集团总部',
                  value: [121.1, 31.45, '集团总部（江苏太仓）'], // 太仓的经纬度
                  symbolSize: 15,
                  itemStyle: {
                    color: '#e53e3e',
                    shadowBlur: 10,
                    shadowColor: '#e53e3e'
                  }
                }
              ],
              symbol: 'circle',
              symbolSize: function(val) {
                return val[2] / 10;
              },
              showEffectOn: 'render',
              rippleEffect: {
                brushType: 'stroke',
                scale: 3
              },
              hoverAnimation: true,
              label: {
                show: true,
                position: 'top',
                formatter: '{b}',
                color: '#e53e3e',
                fontWeight: 'bold',
                fontSize: 12
              },
              itemStyle: {
                color: '#e53e3e',
                shadowBlur: 10,
                shadowColor: '#e53e3e'
              },
              zlevel: 1
            }
          ]
        };
        
        myChart.setOption(option);
        
        // 地图点击事件
        myChart.on('click', function(params) {
          // 如果是总部标记，显示总部岗位列表
          if (params.seriesName === '总部标记') {
            const company = recruitData.find(item => item.region === '总部');
            if (company) {
              showPositionList(company);
            }
          } else {
            // 普通省份点击
            showCompanyList(params.name);
          }
        });
        
        // 窗口大小变化时调整地图大小和字体
        window.addEventListener('resize', function() {
          myChart.resize();
          
          // 重新计算字体大小
          const containerWidth = document.getElementById('map-container').offsetWidth;
          const newFontSize = containerWidth < 768 ? 8 : 10;
          
          // 更新地图选项中的字体大小
          myChart.setOption({
            series: [{
              label: {
                fontSize: newFontSize,
                emphasis: {
                  fontSize: newFontSize + 1
                }
              }
            }]
          });
        });
        
      } catch (error) {
        console.error('地图初始化失败:', error);
        showError('地图加载失败，请刷新页面重试');
        
        // 创建简单的地图作为备选
        const mapContainer = document.getElementById('map-container');
        mapContainer.innerHTML = `
          <div class="flex items-center justify-center h-full">
            <div class="text-center">
              <i class="fa fa-map text-gray-300 text-6xl mb-4"></i>
              <p class="text-gray-500">地图加载失败</p>
              <p class="text-gray-400 text-sm mt-2">请检查网络连接后刷新页面</p>
            </div>
          </div>
        `;
      }
    }

    // 获取省份数据
    function getProvinceData(provinceName) {
      const companies = recruitData.filter(item => item.province === provinceName);
      let positionCount = 0;
      
      companies.forEach(company => {
        positionCount += company.positions.length;
      });
      
      return {
        companies,
        positionCount
      };
    }

    // 绑定事件
    function bindEvents() {
      // 管理员登录相关事件
      document.getElementById('admin-login-btn').addEventListener('click', function() {
        if (isAdminLoggedIn) {
          showAdminPanel();
        } else {
          document.getElementById('login-modal').classList.remove('hidden');
        }
      });

      document.getElementById('login-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        handleAdminLogin(username, password);
      });

      // 搜索功能
      document.getElementById('search-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          const keyword = this.value.trim();
          if (keyword) {
            handleSearch(keyword);
          }
        }
      });

      // 添加公司按钮
      document.getElementById('add-company-btn').addEventListener('click', function() {
        showCompanyForm();
      });

      // 添加岗位按钮
      document.getElementById('add-position-btn').addEventListener('click', function() {
        addPositionForm();
      });

      // 公司表单提交
      document.getElementById('company-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveCompanyData();
      });

      // 关闭按钮事件
      document.getElementById('close-login-modal').addEventListener('click', function() {
        document.getElementById('login-modal').classList.add('hidden');
      });
      
      document.getElementById('close-admin-panel').addEventListener('click', function() {
        document.getElementById('admin-panel-modal').classList.add('hidden');
      });
      
      document.getElementById('close-company-modal-admin').addEventListener('click', function() {
        document.getElementById('company-modal-admin').classList.add('hidden');
      });
      
      document.getElementById('cancel-company-modal').addEventListener('click', function() {
        document.getElementById('company-modal-admin').classList.add('hidden');
      });
      
      document.getElementById('close-search-results').addEventListener('click', function() {
        document.getElementById('search-results-modal').classList.add('hidden');
      });
      
      document.getElementById('close-search-results-btn').addEventListener('click', function() {
        document.getElementById('search-results-modal').classList.add('hidden');
      });
      
      document.getElementById('close-province-companies').addEventListener('click', function() {
        document.getElementById('province-companies-modal').classList.add('hidden');
      });
      
      document.getElementById('close-province-companies-btn').addEventListener('click', function() {
        document.getElementById('province-companies-modal').classList.add('hidden');
      });
      
      document.getElementById('close-company-positions').addEventListener('click', function() {
        document.getElementById('company-positions-modal').classList.add('hidden');
      });
      
      document.getElementById('close-company-positions-btn').addEventListener('click', function() {
        document.getElementById('company-positions-modal').classList.add('hidden');
      });
      
      document.getElementById('close-position-detail').addEventListener('click', function() {
        document.getElementById('position-detail-modal').classList.add('hidden');
      });
      
      document.getElementById('close-position-detail-btn').addEventListener('click', function() {
        document.getElementById('position-detail-modal').classList.add('hidden');
      });
      
      document.getElementById('close-success-modal').addEventListener('click', function() {
        document.getElementById('success-modal').classList.add('hidden');
      });
      
      document.getElementById('close-error-modal').addEventListener('click', function() {
        document.getElementById('error-modal').classList.add('hidden');
      });

      // 新增返回按钮事件
      document.getElementById('back-to-companies-btn').addEventListener('click', function() {
        document.getElementById('company-positions-modal').classList.add('hidden');
        if (currentProvince) {
          showCompanyList(currentProvince);
        }
      });
      
      document.getElementById('back-to-positions-btn').addEventListener('click', function() {
        document.getElementById('position-detail-modal').classList.add('hidden');
        if (currentCompany) {
          showPositionList(currentCompany);
        }
      });

      // Excel上传相关事件 - 修复数据更新问题
      document.getElementById('admin-excel-upload').addEventListener('change', handleExcelUpload);
      document.getElementById('upload-excel-btn').addEventListener('click', handleManualUpload);
      document.getElementById('export-excel-btn').addEventListener('click', exportExcelData);

      // 退出登录
      document.getElementById('logout-btn').addEventListener('click', function() {
        isAdminLoggedIn = false;
        document.getElementById('admin-panel-modal').classList.add('hidden');
        document.getElementById('admin-login-btn').classList.remove('bg-admin', 'text-white');
        document.getElementById('admin-login-btn').classList.add('bg-gray-200', 'text-gray-700');
        document.getElementById('admin-login-btn').innerHTML = '<i class="fa fa-user-secret mr-2"></i>管理员登录';
        showSuccess('已退出管理员登录');
      });

      // 帮助按钮
      document.getElementById('help-btn').addEventListener('click', function() {
        document.getElementById('help-modal').classList.remove('hidden');
      });

      // 关闭帮助弹窗
      document.getElementById('close-help-modal').addEventListener('click', function() {
        document.getElementById('help-modal').classList.add('hidden');
      });
      
      document.getElementById('close-help-modal-btn').addEventListener('click', function() {
        document.getElementById('help-modal').classList.add('hidden');
      });
    }

    // 显示管理员面板
    function showAdminPanel() {
      updateAdminCompanyList();
      document.getElementById('admin-panel-modal').classList.remove('hidden');
    }

    // 显示公司表单（新增或编辑）
    function showCompanyForm(companyIndex = -1) {
      currentEditingCompanyIndex = companyIndex;
      const form = document.getElementById('company-form');
      const modalTitle = document.getElementById('company-modal-title');
      const positionsContainer = document.getElementById('positions-container');
      
      // 重置表单
      form.reset();
      positionsContainer.innerHTML = '';
      
      if (companyIndex === -1) {
        // 新增模式
        modalTitle.textContent = '添加子公司';
        addPositionForm(); // 默认添加一个空岗位表单
      } else {
        // 编辑模式
        modalTitle.textContent = '编辑子公司';
        const company = recruitData[companyIndex];
        
        // 填充公司信息
        document.getElementById('company-region').value = company.region;
        document.getElementById('company-province').value = company.province;
        document.getElementById('company-name').value = company.company;
        document.getElementById('company-address').value = company.address;
        document.getElementById('company-contact').value = company.contact;
        document.getElementById('company-email').value = company.email || '';
        
        // 填充岗位信息
        company.positions.forEach((position, index) => {
          addPositionForm(position, index);
        });
      }
      
      document.getElementById('company-modal-admin').classList.remove('hidden');
    }

    // 添加岗位表单
    function addPositionForm(positionData = {}, index = null) {
      const positionsContainer = document.getElementById('positions-container');
      const positionIndex = index !== null ? index : positionsContainer.children.length;
      
      const positionForm = document.createElement('div');
      positionForm.className = 'border border-gray-200 rounded-lg p-3 md:p-4 bg-white';
      positionForm.innerHTML = `
        <div class="flex justify-between items-center mb-3">
          <h5 class="font-semibold text-gray-800 text-sm md:text-base">岗位信息</h5>
          <button type="button" class="delete-position-btn btn-danger text-xs" data-index="${positionIndex}">
            <i class="fa fa-trash mr-1"></i>删除
          </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 mb-3 md:mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">岗位名称 *</label>
            <input type="text" name="position-name" value="${positionData.name || ''}" 
                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-admin/50 focus:border-admin text-sm md:text-base"
                   placeholder="请输入岗位名称" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">工作地点 *</label>
            <input type="text" name="position-location" value="${positionData.workLocation || ''}" 
                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-admin/50 focus:border-admin text-sm md:text-base"
                   placeholder="请输入工作地点" required>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4 mb-3 md:mb-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">薪资待遇 *</label>
            <input type="text" name="position-salary" value="${positionData.salary || ''}" 
                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-admin/50 focus:border-admin text-sm md:text-base"
                   placeholder="例如：8-15K/月" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">招聘热线</label>
            <input type="text" name="position-hotline" value="${positionData.hotline || ''}" 
                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-admin/50 focus:border-admin text-sm md:text-base"
                   placeholder="例如：400-123-4567">
          </div>
        </div>
        
        <div class="mb-3 md:mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">岗位职责 *</label>
          <textarea name="position-responsibilities" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-admin/50 focus:border-admin text-sm md:text-base"
                    placeholder="每行输入一条职责，或使用分号分隔">${Array.isArray(positionData.responsibilities) ? positionData.responsibilities.join('\n') : (positionData.responsibilities || '')}</textarea>
        </div>
        
        <div class="mb-3 md:mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">岗位要求</label>
          <textarea name="position-requirements" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-admin/50 focus:border-admin text-sm md:text-base"
                    placeholder="每行输入一条要求，或使用分号分隔">${Array.isArray(positionData.requirements) ? positionData.requirements.join('\n') : (positionData.requirements || '')}</textarea>
        </div>
      `;
      
      positionsContainer.appendChild(positionForm);
      
      // 绑定删除按钮事件
      const deleteBtn = positionForm.querySelector('.delete-position-btn');
      deleteBtn.addEventListener('click', function() {
        if (positionsContainer.children.length > 1) {
          positionForm.remove();
        } else {
          showError('至少需要保留一个岗位');
        }
      });
    }

    // 保存公司数据
    function saveCompanyData() {
      const formData = new FormData(document.getElementById('company-form'));
      
      // 验证必填字段
      const requiredFields = ['region', 'province', 'company', 'address', 'contact', 'email'];
      for (let field of requiredFields) {
        if (!formData.get(field)) {
          showError(`请填写${getFieldLabel(field)}`);
          return;
        }
      }
      
      // 收集岗位数据
      const positions = [];
      const positionForms = document.getElementById('positions-container').children;
      
      for (let i = 0; i < positionForms.length; i++) {
        const form = positionForms[i];
        const name = form.querySelector('[name="position-name"]').value;
        const workLocation = form.querySelector('[name="position-location"]').value;
        const salary = form.querySelector('[name="position-salary"]').value;
        const hotline = form.querySelector('[name="position-hotline"]').value;
        const responsibilities = form.querySelector('[name="position-responsibilities"]').value;
        const requirements = form.querySelector('[name="position-requirements"]').value;
        
        if (!name || !workLocation || !salary) {
          showError('请填写完整的岗位信息');
          return;
        }
        
        positions.push({
          name: name,
          workLocation: workLocation,
          salary: salary,
          hotline: hotline,
          responsibilities: responsibilities.split('\n').filter(item => item.trim()),
          requirements: requirements.split('\n').filter(item => item.trim())
        });
      }
      
      // 创建公司数据对象
      const companyData = {
        region: formData.get('region'),
        province: formData.get('province'),
        company: formData.get('company'),
        address: formData.get('address'),
        contact: formData.get('contact'),
        email: formData.get('email'),
        positions: positions
      };
      
      // 保存数据
      if (currentEditingCompanyIndex === -1) {
        // 新增
        recruitData.push(companyData);
        showSuccess('公司添加成功');
      } else {
        // 编辑
        recruitData[currentEditingCompanyIndex] = companyData;
        showSuccess('公司信息更新成功');
      }
      
      // 更新界面
      updateStatistics();
      updateAdminCompanyList();
      document.getElementById('company-modal-admin').classList.add('hidden');
      
      // 重新渲染地图
      if (myChart) {
        myChart.setOption({
          series: [{
            data: getAllProvinceMapData()
          }]
        });
      }
    }

    // 搜索功能
    function handleSearch(keyword) {
      searchResults = [];
      
      // 搜索省份
      const provinceMatches = recruitData.filter(item => 
        item.province.toLowerCase().includes(keyword.toLowerCase())
      );
      
      // 搜索子公司
      const companyMatches = recruitData.filter(item => 
        item.company.toLowerCase().includes(keyword.toLowerCase())
      );
      
      // 搜索岗位
      const positionMatches = [];
      recruitData.forEach(company => {
        company.positions.forEach(position => {
          if (position.name.toLowerCase().includes(keyword.toLowerCase())) {
            positionMatches.push({
              company: company,
              position: position
            });
          }
        });
      });
      
      // 如果没有匹配结果
      if (provinceMatches.length === 0 && companyMatches.length === 0 && positionMatches.length === 0) {
        showError(`未找到包含"${keyword}"的省份、子公司或岗位`);
        return;
      }
      
      // 显示搜索结果
      showSearchResults(keyword, provinceMatches, companyMatches, positionMatches);
    }

    // 显示搜索结果
    function showSearchResults(keyword, provinceMatches, companyMatches, positionMatches) {
      const modal = document.getElementById('search-results-modal');
      const title = document.getElementById('search-results-title');
      const content = document.getElementById('search-results-content');
      
      title.textContent = `搜索"${keyword}"的结果`;
      content.innerHTML = '';
      
      // 省份结果
      if (provinceMatches.length > 0) {
        const provinceSection = document.createElement('div');
        provinceSection.className = 'mb-6';
        provinceSection.innerHTML = `
          <h4 class="text-base md:text-lg font-semibold text-gray-800 mb-3">省份匹配 (${provinceMatches.length})</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${provinceMatches.map(province => `
              <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-gray-50 transition-colors" data-province="${province.province}">
                <h5 class="font-semibold text-gray-800 text-sm md:text-base">${province.province}</h5>
                <p class="text-sm text-gray-600 mt-1">${province.company}</p>
                <p class="text-xs text-gray-500 mt-2">${province.positions.length} 个岗位</p>
              </div>
            `).join('')}
          </div>
        `;
        content.appendChild(provinceSection);
        
        // 绑定点击事件
        provinceSection.querySelectorAll('[data-province]').forEach(item => {
          item.addEventListener('click', function() {
            const province = this.getAttribute('data-province');
            modal.classList.add('hidden');
            showCompanyList(province);
          });
        });
      }
      
      // 公司结果
      if (companyMatches.length > 0) {
        const companySection = document.createElement('div');
        companySection.className = 'mb-6';
        companySection.innerHTML = `
          <h4 class="text-base md:text-lg font-semibold text-gray-800 mb-3">子公司匹配 (${companyMatches.length})</h4>
          <div class="space-y-3">
            ${companyMatches.map(company => `
              <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-gray-50 transition-colors" data-company-index="${recruitData.indexOf(company)}">
                <h5 class="font-semibold text-gray-800 text-sm md:text-base">${company.company}</h5>
                <p class="text-sm text-gray-600 mt-1">${company.province} - ${company.region}</p>
                <p class="text-xs text-gray-500 mt-2">${company.positions.length} 个岗位</p>
              </div>
            `).join('')}
          </div>
        `;
        content.appendChild(companySection);
        
        // 绑定点击事件
        companySection.querySelectorAll('[data-company-index]').forEach(item => {
          item.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-company-index'));
            modal.classList.add('hidden');
            showPositionList(recruitData[index]);
          });
        });
      }
      
      // 岗位结果
      if (positionMatches.length > 0) {
        const positionSection = document.createElement('div');
        positionSection.className = 'mb-6';
        positionSection.innerHTML = `
          <h4 class="text-base md:text-lg font-semibold text-gray-800 mb-3">岗位匹配 (${positionMatches.length})</h4>
          <div class="space-y-3">
            ${positionMatches.map((match, index) => `
              <div class="bg-white border border-gray-200 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-gray-50 transition-colors" data-match-index="${index}">
                <h5 class="font-semibold text-gray-800 text-sm md:text-base">${match.position.name}</h5>
                <p class="text-sm text-gray-600 mt-1">${match.company.company} - <span class="text-primary">工作地点: ${match.position.workLocation}</span></p>
                <p class="text-xs text-gray-500 mt-2">薪资: ${match.position.salary}</p>
              </div>
            `).join('')}
          </div>
        `;
        content.appendChild(positionSection);
        
        // 绑定点击事件
        positionSection.querySelectorAll('[data-match-index]').forEach(item => {
          item.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-match-index'));
            const match = positionMatches[index];
            modal.classList.add('hidden');
            showPositionDetail(match.position, match.company);
          });
        });
      }
      
      modal.classList.remove('hidden');
    }

    // 显示子公司列表
    function showCompanyList(provinceName) {
      currentProvince = provinceName;
      const provinceData = getProvinceData(provinceName);
      
      const modal = document.getElementById('province-companies-modal');
      const title = document.getElementById('province-companies-title');
      const content = document.getElementById('province-companies-content');
      
      title.textContent = `${provinceName} - 子公司列表`;
      content.innerHTML = '';
      
      if (provinceData.companies.length === 0) {
        content.innerHTML = `
          <div class="text-center py-10">
            <i class="fa fa-building text-gray-300 text-5xl mb-4"></i>
            <p class="text-gray-500">该省份暂无子公司</p>
          </div>
        `;
      } else {
        const companiesList = document.createElement('div');
        companiesList.className = 'space-y-4';
        
        provinceData.companies.forEach(company => {
          const companyCard = document.createElement('div');
          companyCard.className = 'bg-white border border-gray-200 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-gray-50 transition-colors';
          companyCard.setAttribute('data-company-index', recruitData.indexOf(company));
          
          companyCard.innerHTML = `
            <div class="flex flex-col md:flex-row justify-between items-start md:items-start">
              <div>
                <h5 class="font-semibold text-gray-800 text-sm md:text-base">${company.company}</h5>
                <p class="text-sm text-gray-600 mt-1">${company.address}</p>
                <p class="text-xs text-gray-500 mt-2">联系电话: ${company.contact}</p>
              </div>
              <div class="text-left md:text-right mt-2 md:mt-0">
                <span class="inline-block bg-primary text-white text-xs px-2 py-1 rounded">${company.positions.length} 个岗位</span>
                <p class="text-xs text-gray-500 mt-1">${company.region}</p>
              </div>
            </div>
          `;
          
          companyCard.addEventListener('click', function() {
            modal.classList.add('hidden');
            showPositionList(company);
          });
          
          companiesList.appendChild(companyCard);
        });
        
        content.appendChild(companiesList);
      }
      
      modal.classList.remove('hidden');
    }

    // 显示岗位列表
    function showPositionList(company) {
      currentCompany = company;
      
      const modal = document.getElementById('company-positions-modal');
      const title = document.getElementById('company-positions-title');
      const content = document.getElementById('company-positions-content');
      
      title.textContent = `${company.company} - 招聘岗位`;
      content.innerHTML = '';
      
      if (company.positions.length === 0) {
        content.innerHTML = `
          <div class="text-center py-10">
            <i class="fa fa-briefcase text-gray-300 text-5xl mb-4"></i>
            <p class="text-gray-500">该公司暂无招聘岗位</p>
          </div>
        `;
      } else {
        const positionsList = document.createElement('div');
        positionsList.className = 'space-y-4';
        
        company.positions.forEach((position, index) => {
          const positionCard = document.createElement('div');
          positionCard.className = 'bg-white border border-gray-200 rounded-lg p-3 md:p-4 cursor-pointer hover:bg-gray-50 transition-colors';
          positionCard.setAttribute('data-position-index', index);
          
          positionCard.innerHTML = `
            <div class="flex flex-col md:flex-row justify-between items-start md:items-start">
              <div>
                <h5 class="font-semibold text-gray-800 text-sm md:text-base">${position.name}</h5>
                <p class="text-sm text-gray-600 mt-1">工作地点: ${position.workLocation}</p>
                <p class="text-sm text-warning mt-1">薪资: ${position.salary}</p>
              </div>
              <div class="text-left md:text-right mt-2 md:mt-0">
                <span class="inline-block bg-success text-white text-xs px-2 py-1 rounded">招聘中</span>
              </div>
            </div>
          `;
          
          positionCard.addEventListener('click', function() {
            modal.classList.add('hidden');
            showPositionDetail(position, company);
          });
          
          positionsList.appendChild(positionCard);
        });
        
        content.appendChild(positionsList);
      }
      
      modal.classList.remove('hidden');
    }

    // 显示岗位详情
    function showPositionDetail(position, company) {
      currentPosition = position;
      
      const modal = document.getElementById('position-detail-modal');
      const title = document.getElementById('position-detail-title');
      const content = document.getElementById('position-detail-content');
      
      title.textContent = position.name;
      content.innerHTML = '';
      
      const positionDetail = document.createElement('div');
      positionDetail.className = 'space-y-6';
      
      // 使用更美观的卡片设计
      positionDetail.innerHTML = `
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 md:p-5 rounded-xl border border-blue-100 shadow-sm">
          <h4 class="font-bold text-gray-800 mb-3 text-base md:text-lg flex items-center">
            <i class="fa fa-info-circle text-primary mr-2"></i>基本信息
          </h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
            <div class="bg-white p-3 rounded-lg shadow-sm">
              <p class="text-xs text-gray-500 mb-1">公司名称</p>
              <p class="font-medium text-gray-800 text-sm md:text-base">${company.company}</p>
            </div>
            <div class="bg-white p-3 rounded-lg shadow-sm">
              <p class="text-xs text-gray-500 mb-1">工作地点</p>
              <p class="font-medium text-gray-800 text-sm md:text-base">${position.workLocation}</p>
            </div>
            <div class="bg-white p-3 rounded-lg shadow-sm">
              <p class="text-xs text-gray-500 mb-1">薪资待遇</p>
              <p class="font-medium text-warning text-sm md:text-base">${position.salary}</p>
            </div>
            <div class="bg-white p-3 rounded-lg shadow-sm">
              <p class="text-xs text-gray-500 mb-1">招聘热线</p>
              <p class="font-medium text-gray-800 text-sm md:text-base">${position.hotline || company.contact}</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-4 md:p-5 rounded-xl border border-gray-200 shadow-sm">
          <h4 class="font-bold text-gray-800 mb-3 text-base md:text-lg flex items-center">
            <i class="fa fa-tasks text-success mr-2"></i>岗位职责
          </h4>
          <ul class="space-y-2">
            ${position.responsibilities.map(resp => `
              <li class="flex items-start text-gray-700 text-sm md:text-base">
                <i class="fa fa-check-circle text-success mr-2 mt-1 flex-shrink-0"></i>
                <span>${resp}</span>
              </li>
            `).join('')}
          </ul>
        </div>
        
        <div class="bg-white p-4 md:p-5 rounded-xl border border-gray-200 shadow-sm">
          <h4 class="font-bold text-gray-800 mb-3 text-base md:text-lg flex items-center">
            <i class="fa fa-graduation-cap text-warning mr-2"></i>岗位要求
          </h4>
          <ul class="space-y-2">
            ${position.requirements.map(req => `
              <li class="flex items-start text-gray-700 text-sm md:text-base">
                <i class="fa fa-check text-primary mr-2 mt-1 flex-shrink-0"></i>
                <span>${req}</span>
              </li>
            `).join('')}
          </ul>
        </div>
        
        <div class="bg-gradient-to-r from-green-50 to-teal-50 p-4 md:p-5 rounded-xl border border-green-100 shadow-sm">
          <h4 class="font-bold text-green-800 mb-4 text-base md:text-lg flex items-center">
            <i class="fa fa-paper-plane text-green-600 mr-2"></i>我要投递
          </h4>
          <div class="flex flex-col sm:flex-row gap-3 md:gap-4">
            <a href="tel:${position.hotline || company.contact}" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg text-center transition-colors flex items-center justify-center text-sm md:text-base shadow-md hover:shadow-lg">
              <i class="fa fa-phone mr-2"></i>电话咨询
            </a>
            <a href="mailto:${company.email}" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg text-center transition-colors flex items-center justify-center text-sm md:text-base shadow-md hover:shadow-lg">
              <i class="fa fa-envelope mr-2"></i>邮箱投递
            </a>
          </div>
        </div>
      `;
      
      content.appendChild(positionDetail);
      modal.classList.remove('hidden');
    }

    // 管理员登录验证
    function handleAdminLogin(username, password) {
      if (username === 'anyou' && password === 'Ans33006666') {
        isAdminLoggedIn = true;
        document.getElementById('login-modal').classList.add('hidden');
        document.getElementById('admin-login-btn').classList.remove('bg-gray-200', 'text-gray-700');
        document.getElementById('admin-login-btn').classList.add('bg-admin', 'text-white');
        document.getElementById('admin-login-btn').innerHTML = '<i class="fa fa-user-secret mr-2"></i>管理员';
        showAdminPanel();
        showSuccess('管理员登录成功');
      } else {
        showError('账号或密码错误');
      }
    }

    // 更新管理员面板的公司列表
    function updateAdminCompanyList() {
      const companyList = document.getElementById('admin-company-list');
      const dataCount = document.getElementById('admin-data-count');
      const positionCount = document.getElementById('admin-position-count');
      
      companyList.innerHTML = '';
      
      let totalPositions = 0;
      
      recruitData.forEach((company, index) => {
        totalPositions += company.positions.length;
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="text-xs md:text-sm">${company.region}</td>
          <td class="text-xs md:text-sm">${company.province}</td>
          <td class="text-xs md:text-sm">${company.company}</td>
          <td class="text-xs md:text-sm">${company.positions.length}</td>
          <td>
            <div class="flex gap-2">
              <button class="edit-company-btn btn-warning text-xs" data-index="${index}">
                <i class="fa fa-edit mr-1"></i>编辑
              </button>
              <button class="delete-company-btn btn-danger text-xs" data-index="${index}">
                <i class="fa fa-trash mr-1"></i>删除
              </button>
            </div>
          </td>
        `;
        companyList.appendChild(row);
      });
      
      // 更新统计
      dataCount.textContent = recruitData.length;
      positionCount.textContent = totalPositions;
      
      // 绑定按钮事件
      document.querySelectorAll('.edit-company-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          showCompanyForm(index);
        });
      });
      
      document.querySelectorAll('.delete-company-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          deleteCompany(index);
        });
      });
    }

    // 删除公司
    function deleteCompany(index) {
      if (confirm('确定要删除该公司及其所有招聘岗位吗？此操作不可恢复。')) {
        recruitData.splice(index, 1);
        updateStatistics();
        updateAdminCompanyList();
        showSuccess('公司删除成功');
        
        // 重新渲染地图
        if (myChart) {
          myChart.setOption({
            series: [{
              data: getAllProvinceMapData()
            }]
          });
        }
      }
    }

    // 获取完整的省份地图数据
    function getAllProvinceMapData() {
      const mapData = [];
      
      allProvinces.forEach(province => {
        const provinceData = getProvinceData(province);
        mapData.push({
          name: province,
          value: provinceData.positionCount,
          itemStyle: {
            areaColor: provinceData.positionCount > 0 ? '#4299e1' : '#e8f4f8'
          }
        });
      });
      
      return mapData;
    }

    // 显示总部标记点
    function showHeadquartersMarker() {
      // 这个函数现在不需要了，因为总部标记已经通过ECharts系列添加
    }

    // 更新统计数据
    function updateStatistics() {
      const companyCount = recruitData.length;
      let totalPositions = 0;
      
      // 重置区域计数
      Object.keys(regionConfig).forEach(region => {
        regionConfig[region].count = 0;
      });
      
      // 计算统计数据
      recruitData.forEach(company => {
        totalPositions += company.positions.length;
        if (regionConfig[company.region]) {
          regionConfig[company.region].count += company.positions.length;
        }
      });
      
      // 更新DOM
      document.getElementById('company-count').textContent = companyCount;
      document.getElementById('position-count').textContent = totalPositions;
      
      // 更新区域计数显示 - 只显示有招聘岗位的区域
      const regionCountsContainer = document.getElementById('region-counts');
      regionCountsContainer.innerHTML = '';
      
      Object.keys(regionConfig).forEach(region => {
        if (regionConfig[region].count > 0) {
          const regionSpan = document.createElement('span');
          regionSpan.className = 'flex items-center';
          regionSpan.innerHTML = `
            <span class="w-3 h-3 rounded-full bg-${region === '华北' ? 'north' : region === '华南' ? 'south' : region === '华中' ? 'central' : region === '添加剂' ? 'additive' : region === '预混料' ? 'premix' : 'headquarters'} mr-1"></span>
            ${region}: <span class="font-bold">${regionConfig[region].count}</span>
          `;
          regionCountsContainer.appendChild(regionSpan);
        }
      });
    }

    // 辅助函数
    function getFieldLabel(field) {
      const labels = {
        'region': '所属区域',
        'province': '省份',
        'company': '公司名称',
        'address': '公司地址',
        'contact': '联系电话',
        'email': '招聘邮箱'
      };
      return labels[field] || field;
    }

    function showSuccess(message) {
      document.getElementById('success-message').textContent = message;
      document.getElementById('success-modal').classList.remove('hidden');
    }

    function showError(message) {
      document.getElementById('error-message').textContent = message;
      document.getElementById('error-modal').classList.remove('hidden');
    }

    // Excel上传相关函数 - 修复数据更新问题
    function handleExcelUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      processExcelFile(file);
    }

    function handleManualUpload() {
      const fileInput = document.getElementById('admin-excel-upload');
      if (!fileInput.files.length) {
        showError('请先选择Excel文件');
        return;
      }
      
      const file = fileInput.files[0];
      processExcelFile(file);
    }

    // 处理Excel文件的通用函数
    function processExcelFile(file) {
      document.getElementById('upload-loading').classList.remove('hidden');
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          
          // 假设第一个工作表包含招聘数据
          const worksheet = workbook.Sheets[workbook.SheetNames[0]];
          const jsonData = XLSX.utils.sheet_to_json(worksheet);
          
          // 将Excel数据转换为recruitData格式
          const newRecruitData = convertExcelToRecruitData(jsonData);
          
          // 更新全局数据
          recruitData = newRecruitData;
          
          // 更新界面
          updateStatistics();
          updateAdminCompanyList();
          
          // 重新渲染地图
          if (myChart) {
            myChart.setOption({
              series: [{
                data: getAllProvinceMapData()
              }]
            });
          }
          
          document.getElementById('upload-loading').classList.add('hidden');
          showSuccess('Excel文件已成功上传并更新数据');
          
        } catch (error) {
          console.error('Excel文件处理失败:', error);
          document.getElementById('upload-loading').classList.add('hidden');
          showError('Excel文件处理失败，请检查文件格式是否正确');
        }
      };
      
      reader.onerror = function() {
        document.getElementById('upload-loading').classList.add('hidden');
        showError('文件读取失败，请重试');
      };
      
      reader.readAsArrayBuffer(file);
    }

    // 将Excel数据转换为recruitData格式
    function convertExcelToRecruitData(excelData) {
      const companyMap = {};
      
      excelData.forEach(row => {
        const companyKey = `${row.区域}-${row.省份}-${row.公司名称}`;
        
        if (!companyMap[companyKey]) {
          companyMap[companyKey] = {
            region: row.区域,
            province: row.省份,
            company: row.公司名称,
            address: row.公司地址,
            contact: row.联系电话,
            email: row.招聘邮箱,
            positions: []
          };
        }
        
        // 添加岗位信息
        companyMap[companyKey].positions.push({
          name: row.岗位名称,
          workLocation: row.工作地点,
          hotline: row.招聘热线 || '',
          salary: row.薪资待遇,
          responsibilities: Array.isArray(row.岗位职责) ? row.岗位职责 : (row.岗位职责 ? row.岗位职责.split('；') : []),
          requirements: Array.isArray(row.岗位要求) ? row.岗位要求 : (row.岗位要求 ? row.岗位要求.split('；') : [])
        });
      });
      
      // 转换为数组格式
      return Object.values(companyMap);
    }

    function exportExcelData() {
      document.getElementById('upload-loading').classList.remove('hidden');
      
      // 创建Excel工作簿
      const wb = XLSX.utils.book_new();
      
      // 创建工作表数据
      const excelData = [];
      
      // 添加表头 - 新增招聘热线列
      excelData.push(['区域', '省份', '公司名称', '公司地址', '联系电话', '招聘邮箱', '岗位名称', '工作地点', '招聘热线', '薪资待遇', '岗位职责', '岗位要求']);
      
      // 添加数据行
      recruitData.forEach(company => {
        company.positions.forEach(position => {
          excelData.push([
            company.region,
            company.province,
            company.company,
            company.address,
            company.contact,
            company.email,
            position.name,
            position.workLocation,
            position.hotline || '',
            position.salary,
            Array.isArray(position.responsibilities) ? position.responsibilities.join('；') : position.responsibilities,
            Array.isArray(position.requirements) ? position.requirements.join('；') : position.requirements
          ]);
        });
      });
      
      // 创建工作表
      const ws = XLSX.utils.aoa_to_sheet(excelData);
      
      // 将工作表添加到工作簿
      XLSX.utils.book_append_sheet(wb, ws, '招聘数据');
      
      // 生成Excel文件并下载
      XLSX.writeFile(wb, 'XX集团招聘数据.xlsx');
      
      // 隐藏加载提示
      setTimeout(() => {
        document.getElementById('upload-loading').classList.add('hidden');
        showSuccess('Excel数据已成功导出');
      }, 1000);
    }
  </script>
</body>
</html>
